<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kong의 로또번호 맞추기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 25px;
            background-color: #f5f5f5;
        }   
        h3  {
            color: #333;   
        }   
        p { 
            font-size: 18px;
            color: #777;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .lotto-number {
            font-weight: bold;
            color: #e91e63;
        }
    </style>
</head>
<body>  
    <h3>로또 번호 맞추기 (대박 나세요!!)</h3><br>
    
    <div>
        <ul id="lottoNumbersList">
            <!-- 여기에 로또 번호가 삽입됩니다 -->
        </ul>
    </div>

    <p>이 프로그램은 개인의 공부를 위해서 만들었으며, 영리목적으로 사용할 수 없습니다.</p>
    <p>2024. 4. 7. 수정</p>
    <p>2025. 4. 7. Perplexity, Claude, VScode로 수정</p>
    <p>2025. 6. 5.  그룹1,2,3의 적용변경및 음력날짜 적용</p>
    <p>nanireu@gmail.com</p>

    <script>
        // lotto_data_with_lunar.json 파일에서 데이터를 불러와 출현 빈도를 계산
        async function loadLottoData() {
            try {
                const response = await fetch('lotto_data_with_lunar.json'); // lotto_data_with_lunar.json 파일 로드
                if (!response.ok) {
                    throw new Error('JSON 파일을 불러오는 데 실패했습니다.');
                }
                const lottoData = await response.json(); // JSON 데이터 파싱
                calculateFrequency(lottoData); // 출현 빈도 계산
            } catch (error) {
                console.error('로또 데이터를 불러오는 중 오류 발생:', error);
            }
        }

        // 출현 빈도를 계산하는 함수
        function calculateFrequency(lottoData) {
            const frequency = {};

            // 각 회차의 번호를 순회하며 빈도 계산
            lottoData.forEach(draw => {
                draw.numbers.forEach(number => {
                    frequency[number] = (frequency[number] || 0) + 1;
                });
                // 보너스 번호는 가중치 0.5로 빈도에 포함
                if (draw.bonus !== undefined) {
                    frequency[draw.bonus] = (frequency[draw.bonus] || 0) + 0.5;
                }
            });

            // 출현 빈도에 따라 로또 번호를 그룹화
            groupLottoNumbers(frequency);
        }

        // 출현 빈도에 따라 로또 번호를 그룹화하는 함수
        function groupLottoNumbers(frequency) {
            const lottoByWinCount = {};

            for (const [number, count] of Object.entries(frequency)) {
                if (!lottoByWinCount[count]) {
                    lottoByWinCount[count] = [];
                }
                lottoByWinCount[count].push(Number(number));
            }

            // 그룹화된 데이터를 기반으로 로또 번호 세트를 생성
            groupAndGenerateLottoSets(lottoByWinCount);
        }

        // 그룹화된 데이터를 기반으로 로또 번호 세트를 생성하는 함수
        function groupAndGenerateLottoSets(lottoByWinCount) {
            const groupedLottoByWinCount = { group1: {}, group2: {}, group3: {} };

            // 당첨 횟수를 기준으로 오름차순 정렬
            const sortedKeys = Object.keys(lottoByWinCount).sort((a, b) => Number(a) - Number(b));
            const groupSize = Math.ceil(sortedKeys.length / 3);

            // 그룹 분할 (group1: 최저 당첨, group2: 중간 당첨, group3: 최다 당첨)
            for (let i = 0; i < sortedKeys.length; i++) {
                const key = sortedKeys[i];
                if (i < groupSize) {
                    groupedLottoByWinCount.group1[key] = lottoByWinCount[key];
                } else if (i < groupSize * 2) {
                    groupedLottoByWinCount.group2[key] = lottoByWinCount[key];
                } else {
                    groupedLottoByWinCount.group3[key] = lottoByWinCount[key];
                }
            }

            // 로또 번호 세트 생성 및 표시
            displayLottoSets(groupedLottoByWinCount);
        }

        // 로또 번호 세트를 생성하고 화면에 표시하는 함수
        function displayLottoSets(groupedLottoByWinCount) {
            const numbersList = document.getElementById('lottoNumbersList');

            // 로또 번호 세트 생성 함수
            function generateLottoSet() {
                const randomValues = [];

                // 각 그룹에서 번호를 선택
                ['group1', 'group2', 'group3'].forEach((group, index) => {
                    const count = index === 0 ? 3 : index === 1 ? 2 : 1; // group1: 3개, group2: 2개, group3: 1개
                    const keys = Object.keys(groupedLottoByWinCount[group]);

                    for (let i = 0; i < count; i++) {
                        if (keys.length === 0) break;

                        const randomIndex = Math.floor(Math.random() * keys.length);
                        const randomKey = keys[randomIndex];
                        const values = groupedLottoByWinCount[group][randomKey];
                        const randomValue = values[Math.floor(Math.random() * values.length)];

                        if (!randomValues.includes(randomValue)) {
                            randomValues.push(randomValue);
                        } else {
                            i--; // 중복이면 다시 시도
                        }
                    }
                });

                // 번호를 오름차순으로 정렬
                return randomValues.sort((a, b) => a - b);
            }

            // 5세트의 로또 번호 생성
            for (let i = 1; i <= 5; i++) {
                const lottoSet = generateLottoSet();
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${i}번 로또번호: <span class="lotto-number">${lottoSet.join(', ')}</span></strong>`;
                numbersList.appendChild(listItem);
            }
        }

        // 페이지 로드 시 JSON 데이터 로드
        window.onload = loadLottoData;
    </script>
</body>
</html>
